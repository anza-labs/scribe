# yaml-language-server: $schema=https://raw.githubusercontent.com/kyverno/chainsaw/main/.schemas/json/test-chainsaw-v1alpha1.json
apiVersion: chainsaw.kyverno.io/v1alpha1
kind: Test
metadata:
  name: annotations
spec:
  steps:
  - name: Check if Scribe is installed
    try:
    - assert:
        resource:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: scribe-controller-manager
            namespace: scribe-system
          status:
            availableReplicas: 1
  - name: Create annotated Namespace and test Deployment
    try:
    - apply:
        resource:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: ($namespace)
            annotations:
              scribe.anza-labs.dev/annotations: foo=bar
    - apply:
        resource:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: test
          spec:
            selector:
              matchLabels:
                app: test
            template:
              metadata:
                labels:
                  app: test
              spec:
                containers:
                - name: test
                  image: docker.io/library/nginx:latest
  - name: Validate if the annotation is propagated
    try:
    - assert:
        resource:
          apiVersion: apps/v1
          kind: Deployment
          metadata:
            name: test
            annotations:
              foo: bar
